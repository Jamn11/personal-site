---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await getCollection('posts');
// Filter out drafts and sort by date (newest first)
const publishedPosts = posts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<BaseLayout title="Writing - Jackson's Site">
	<div class="header">
		<h1>Writing</h1>
		<a href="/rss.xml" class="rss-link">RSS Feed</a>
	</div>
	<p>Thoughts, ideas, and reflections on various topics.</p>
	
	{publishedPosts.length === 0 ? (
		<p>No posts yet. Check back soon!</p>
	) : (
		<div class="posts-list">
			{publishedPosts.map((post) => (
				<article class="post-preview">
					<h2>
						<a href={`/posts/${post.slug}`}>{post.data.title}</a>
					</h2>
					<p class="description">{post.data.description}</p>
					<time datetime={post.data.date.toISOString()}>
						{post.data.date.toLocaleDateString('en-US', {
							year: 'numeric',
							month: 'long',
							day: 'numeric'
						})}
					</time>
					{post.data.tags && (
						<div class="tags">
							{post.data.tags.map(tag => <span class="tag">#{tag}</span>)}
						</div>
					)}
				</article>
			))}
		</div>
	)}
</BaseLayout>

<style>
	.header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1rem;
	}
	
	.rss-link {
		color: #58a6ff;
		text-decoration: none;
		font-size: 0.9rem;
		padding: 0.25rem 0.75rem;
		border: 1px solid #58a6ff;
		border-radius: 0.375rem;
		transition: background-color 0.2s;
	}
	
	.rss-link:hover {
		background-color: #58a6ff;
		color: #0d1117;
		text-decoration: none;
	}

	.posts-list {
		margin-top: 2rem;
	}
	
	.post-preview {
		margin-bottom: 2rem;
		padding-bottom: 1.5rem;
		border-bottom: 1px solid #30363d;
	}
	
	.post-preview:last-child {
		border-bottom: none;
	}
	
	.post-preview h2 {
		margin-bottom: 0.5rem;
	}
	
	.post-preview h2 a {
		color: #58a6ff;
		text-decoration: none;
	}
	
	.post-preview h2 a:hover {
		text-decoration: underline;
	}
	
	.description {
		color: #8b949e;
		font-style: italic;
		margin-bottom: 0.75rem;
	}
	
	time {
		color: #7d8590;
		font-size: 0.9rem;
	}
	
	.tags {
		margin-top: 0.5rem;
	}
	
	.tag {
		color: #58a6ff;
		font-size: 0.85rem;
		margin-right: 0.5rem;
	}
</style>